<!-- Generated by SpecStory -->

# Extending Wallet Connect for Solflare (2025-05-05 16:52:08)

_**User**_

i want to extend my wallet connect by adding the possibility for solflware wallet conenct

---

_**Assistant**_

I'll help you extend the wallet connection functionality to include Solflare wallet support. First, let me check the existing wallet context implementation to understand how to best integrate this.


---

<details>
            <summary>Searched codebase "wallet context implementation useWallet" • **14** results</summary>
        
| File | Lines |
|------|-------|
| `context/wallet-context.tsx` | L176-184 |
| `context/wallet-context.tsx` | L28-55 |
| `context/wallet-context.tsx` | L1-28 |
| `context/wallet-context.tsx` | L103-176 |
| `context/auth-context.tsx` | L1-26 |
| `context/wallet-context.tsx` | L55-103 |
| `context/auth-context.tsx` | L35-100 |
| `components/wallet-button.tsx` | L1-65 |
| `components/wallet-connect.tsx` | L1-46 |
| `context/auth-context.tsx` | L100-153 |
| `components/wallet-connect.tsx` | L46-74 |
| `components/wallet-button.tsx` | L65-111 |
| `components/header.tsx` | L1-25 |
| `components/wallet-connect.tsx` | L189-229 |

</details>

---

I see that you're currently using the Phantom wallet adapter. Let's extend this to support Solflare as well. First, we'll need to install the Solflare wallet adapter package. I'll help you set this up step by step.

1. First, let's install the required package:


---

```bash
npm install @solana/wallet-adapter-solflare
```

```
npm error code ERESOLVE
npm error ERESOLVE could not resolve
npm error
npm error While resolving: react-day-picker@8.10.1
npm error Found: react@19.1.0
npm error node_modules/react
npm error   peer react@">=16.8.0" from @floating-ui/react-dom@2.1.2
npm error   node_modules/@floating-ui/react-dom
npm error     @floating-ui/react-dom@"^2.0.0" from @radix-ui/react-popper@1.2.1
npm error     node_modules/@radix-ui/react-popper
npm error       @radix-ui/react-popper@"1.2.1" from @radix-ui/react-hover-card@1
.1.4
npm error       node_modules/@radix-ui/react-hover-card
npm error         @radix-ui/react-hover-card@"1.1.4" from the root project
npm error       4 more (@radix-ui/react-menu, @radix-ui/react-popover, ...)
npm error   peer react@"^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc" from @ra
dix-ui/react-accordion@1.2.2
npm error   node_modules/@radix-ui/react-accordion
npm error     @radix-ui/react-accordion@"1.2.2" from the root project
npm error   70 more (@radix-ui/react-alert-dialog, @radix-ui/react-arrow, ...)
npm error
npm error Could not resolve dependency:
npm error peer react@"^16.8.0 || ^17.0.0 || ^18.0.0" from react-day-picker@8.10.
1
npm error node_modules/react-day-picker
npm error   react-day-picker@"8.10.1" from the root project
npm error
npm error Conflicting peer dependency: react@18.3.1
npm error node_modules/react
npm error   peer react@"^16.8.0 || ^17.0.0 || ^18.0.0" from react-day-picker@8.1
0.1
npm error   node_modules/react-day-picker
npm error     react-day-picker@"8.10.1" from the root project
npm error
npm error Fix the upstream dependency conflict, or retry
npm error this command with --force or --legacy-peer-deps
npm error to accept an incorrect (and potentially broken) dependency resolution.
npm error
npm error
npm error For a full report see:
npm error /Users/alexsemenov/.npm/_logs/2025-05-05T14_52_38_099Z-eresolve-report
.txt
npm error A complete log of this run can be found in: /Users/alexsemenov/.npm/_l
ogs/2025-05-05T14_52_38_099Z
-debug-0.log
                            
```

---

Let's try installing with the --legacy-peer-deps flag to resolve the dependency conflicts:


---

```bash
npm install @solana/wallet-adapter-solflare --legacy-peer-deps
```

```
(base) ?➜  invofi git:(develop/frontend) ?✗ npm install @solana/wallet-adapter-solflare --legacy-peer-deps

added 369 packages, and audited 370 packages in 40s

72 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities
(base) ?➜  invofi git:(develop/frontend) ?✗
```

---

Now that we have the Solflare adapter installed, let's modify the wallet context to support both Phantom and Solflare wallets. I'll update the wallet context implementation:


---

```diff
  import { Connection, PublicKey } from "@solana/web3.js"
  import { PhantomWalletAdapter } from "@solana/wallet-adapter-phantom"
+ import { SolflareWalletAdapter } from "@solana/wallet-adapter-solflare"
  import { getSolanaConnection } from "@/lib/solana-config"
  
  interface WalletContextType {
    isConnected: boolean
    address: string | null
-   connect: () => Promise<void>
+   connect: (walletType: 'phantom' | 'solflare') => Promise<void>
    disconnect: () => void
    connection: Connection | null
```

```diff
    const [isConnected, setIsConnected] = useState(false)
    const [address, setAddress] = useState<string | null>(null)
-   const [wallet, setWallet] = useState<PhantomWalletAdapter | null>(null)
+   const [phantomWallet, setPhantomWallet] = useState<PhantomWalletAdapter | null>(null)
+   const [solflareWallet, setSolflareWallet] = useState<SolflareWalletAdapter | null>(null)
    const [connection, setConnection] = useState<Connection | null>(null)
    const { toast } = useToast()
  
-   // Initialize wallet adapter and connection
+   // Initialize wallet adapters and connection
    useEffect(() => {
      const phantomWallet = new PhantomWalletAdapter()
-     setWallet(phantomWallet)
+     const solflareWallet = new SolflareWalletAdapter()
+     
+     setPhantomWallet(phantomWallet)
+     setSolflareWallet(solflareWallet)
      setConnection(getSolanaConnection())
    }, [])
```

```diff
    }, [])
  
-   const connect = async () => {
+   const connect = async (walletType: 'phantom' | 'solflare') => {
      try {
+       const wallet = walletType === 'phantom' ? phantomWallet : solflareWallet
        if (!wallet) {
          throw new Error("Wallet adapter not initialized")
```

```diff
          localStorage.setItem("invofi_wallet", JSON.stringify({ 
            address: publicKey.toString(),
-           signature: Array.from(signature)
+           signature: Array.from(signature),
+           walletType
          }))
  
          toast({
            title: "Wallet Connected",
-           description: "Your wallet has been successfully connected.",
+           description: `Your ${walletType} wallet has been successfully connected.`,
          })
  
```

```diff
  
    const disconnect = () => {
-     if (wallet) {
-       wallet.disconnect()
+     if (phantomWallet) {
+       phantomWallet.disconnect()
+     }
+     if (solflareWallet) {
+       solflareWallet.disconnect()
      }
      setIsConnected(false)
```

---

Now let's update the wallet button component to support both wallet types:


---

```diff
    const [isConnecting, setIsConnecting] = useState(false)
  
-   const handleConnect = async () => {
+   const handleConnect = async (walletType: 'phantom' | 'solflare') => {
      setIsConnecting(true)
      try {
-       await connect()
+       await connect(walletType)
      } catch (error) {
        console.error("Failed to connect wallet:", error)
```

```diff
    if (!isConnected) {
      return (
-       <Button 
-         size="sm" 
-         className="bg-primary text-primary-foreground hover:bg-primary/90"
-         onClick={handleConnect} 
-         disabled={isConnecting}
-       >
-         <Wallet className="h-4 w-4" />
-         {isConnecting ? "Connecting..." : "Connect"}
-       </Button>
+       <DropdownMenu>
+         <DropdownMenuTrigger asChild>
+           <Button 
+             size="sm" 
+             className="bg-primary text-primary-foreground hover:bg-primary/90"
+             disabled={isConnecting}
+           >
+             <Wallet className="h-4 w-4" />
+             {isConnecting ? "Connecting..." : "Connect Wallet"}
+           </Button>
+         </DropdownMenuTrigger>
+         <DropdownMenuContent align="end" className="w-56">
+           <DropdownMenuLabel>Select Wallet</DropdownMenuLabel>
+           <DropdownMenuSeparator />
+           <DropdownMenuItem onClick={() => handleConnect('phantom')}>
+             <span>Phantom</span>
+           </DropdownMenuItem>
+           <DropdownMenuItem onClick={() => handleConnect('solflare')}>
+             <span>Solflare</span>
+           </DropdownMenuItem>
+         </DropdownMenuContent>
+       </DropdownMenu>
      )
    }
```

---

I've made the following changes to implement Solflare wallet support:

1. Added the Solflare wallet adapter package
2. Updated the wallet context to:
   - Support both Phantom and Solflare wallets
   - Store the wallet type in localStorage
   - Handle disconnection for both wallet types
   - Show appropriate toast messages for each wallet type

3. Updated the wallet button component to:
   - Show a dropdown menu when connecting
   - Allow users to choose between Phantom and Solflare
   - Maintain the same functionality for connected wallets

Now users can:
1. Click the "Connect Wallet" button
2. Choose between Phantom and Solflare wallets
3. Connect with their preferred wallet
4. Use all the existing functionality (copy address, view on Solscan, disconnect)

The changes maintain all existing functionality while adding support for Solflare. The UI is clean and intuitive, with a dropdown menu for wallet selection that appears only when needed.

Would you like me to make any adjustments to this implementation?

---

