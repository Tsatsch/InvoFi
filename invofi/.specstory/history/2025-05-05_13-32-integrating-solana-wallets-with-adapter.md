<!-- Generated by SpecStory -->

# Integrating Solana Wallets with Adapter (2025-05-05 15:32:55)

_**User**_

lets integrate plain solana wallet integration with wallet-adapter instead of the login. The wallet should support phantom, backpack and solflare at least

---

_**Assistant**_

I'll help you integrate Solana wallet adapter with support for Phantom, Backpack, and Solflare wallets. First, let me check the current codebase structure to understand where we need to make changes.


---

<details>
            <summary>Listed current directory • **22** results</summary>
        
| Name |
|-------|
| 📄 `.gitignore` |
| 📄 `package.json` |
| 📁 `public` |
| 📄 `package-lock.json` |
| 📁 `context` |
| 📁 `app` |
| 📁 `components` |
| 📁 `.next` |
| 📁 `node_modules` |
| 📄 `.cursorindexingignore` |
| 📁 `.specstory` |
| 📄 `next-env.d.ts` |
| 📄 `.DS_Store` |
| 📁 `styles` |
| 📄 `tailwind.config.ts` |
| 📄 `tsconfig.json` |
| 📄 `postcss.config.mjs` |
| 📄 `pnpm-lock.yaml` |
| 📄 `next.config.mjs` |
| 📁 `hooks` |
| 📁 `lib` |
| 📄 `components.json` |

</details>

---

Let me check the package.json to see what dependencies we need to add.


---

Read file: package.json

---

First, we need to install the required Solana wallet adapter packages. I'll propose the command to install them:


---

```bash
npm install @solana/wallet-adapter-react @solana/wallet-adapter-react-ui @solana/wallet-adapter-base @solana/wallet-adapter-wallets @solana/web3.js
```

```
npm warn ERESOLVE overriding peer dependency
npm warn ERESOLVE overriding peer dependency
npm warn ERESOLVE overriding peer dependency
npm error code ERESOLVE
npm error ERESOLVE could not resolve
npm error
npm error While resolving: react-day-picker@8.10.1
npm error Found: react@19.1.0
npm error node_modules/react
npm error   peer react@"^15.5.3 || ^16.0.0 || ^17.0.0" from qrcode.react@1.0.1
npm error   node_modules/@keystonehq/sdk/node_modules/qrcode.react
npm error     qrcode.react@"^1.0.1" from @keystonehq/sdk@0.19.2
npm error     node_modules/@keystonehq/sdk
npm error       @keystonehq/sdk@"^0.19.2" from @keystonehq/sol-keyring@0.20.0
npm error       node_modules/@keystonehq/sol-keyring
npm error         @keystonehq/sol-keyring@"^0.20.0" from @solana/wallet-adapter-
keystone@0.1.18
npm error         node_modules/@solana/wallet-adapter-keystone
npm error
npm error Could not resolve dependency:
npm error peer react@"^16.8.0 || ^17.0.0 || ^18.0.0" from react-day-picker@8.10.
1
npm error node_modules/react-day-picker
npm error   react-day-picker@"8.10.1" from the root project
npm error
npm error Conflicting peer dependency: react@18.3.1
npm error node_modules/react
npm error   peer react@"^16.8.0 || ^17.0.0 || ^18.0.0" from react-day-picker@8.1
0.1
npm error   node_modules/react-day-picker
npm error     react-day-picker@"8.10.1" from the root project
npm error
npm error Fix the upstream dependency conflict, or retry
npm error this command with --force or --legacy-peer-deps
npm error to accept an incorrect (and potentially broken) dependency resolution.
npm error
npm error
npm error For a full report see:
npm error /Users/alexsemenov/.npm/_logs/2025-05-05T13_33_51_140Z-eresolve-report
.txt
npm error A complete log of this run can be found in: /Users/alexsemenov/.npm/_l
ogs/2025-05-05T13_33_51_140Z
-debug-0.log
                            
```

---

I see we have a dependency conflict. Let's try installing with the --legacy-peer-deps flag:


---

```bash
npm install @solana/wallet-adapter-react @solana/wallet-adapter-react-ui @solana/wallet-adapter-base @solana/wallet-adapter-wallets @solana/web3.js --legacy-peer-deps
```

```
<ct-ui @solana/wallet-adapter-base @solana/wallet-adapter-wallets @solana/web3.js --legacy-peer-deps

added 99 packages, removed 591 packages, changed 26 packages, and audited 953 packages in 46s

133 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities
(base) ➜  invofi git:(develop/frontend) ✗
```

---

Great! Now let's create the necessary components and context for the wallet integration. First, I'll create a wallet provider context:


---

```diff
- 
+ import { FC, ReactNode, useMemo } from 'react';
+ import { ConnectionProvider, WalletProvider as SolanaWalletProvider } from '@solana/wallet-adapter-react';
+ import { WalletAdapterNetwork } from '@solana/wallet-adapter-base';
+ import { PhantomWalletAdapter, BackpackWalletAdapter, SolflareWalletAdapter } from '@solana/wallet-adapter-wallets';
+ import { WalletModalProvider } from '@solana/wallet-adapter-react-ui';
+ import { clusterApiUrl } from '@solana/web3.js';
+ 
+ // Default styles that can be overridden by your app
+ require('@solana/wallet-adapter-react-ui/styles.css');
+ 
+ interface WalletProviderProps {
+   children: ReactNode;
+ }
+ 
+ export const WalletProvider: FC<WalletProviderProps> = ({ children }) => {
+   // The network can be set to 'devnet', 'testnet', or 'mainnet-beta'.
+   const network = WalletAdapterNetwork.Mainnet;
+ 
+   // You can also provide a custom RPC endpoint.
+   const endpoint = useMemo(() => clusterApiUrl(network), [network]);
+ 
+   // @solana/wallet-adapter-wallets includes all the adapters but supports tree shaking and lazy loading
+   // Only the wallets you configure here will be compiled into your application
+   const wallets = useMemo(
+     () => [
+       new PhantomWalletAdapter(),
+       new BackpackWalletAdapter(),
+       new SolflareWalletAdapter(),
+     ],
+     []
+   );
+ 
+   return (
+     <ConnectionProvider endpoint={endpoint}>
+       <SolanaWalletProvider wallets={wallets} autoConnect>
+         <WalletModalProvider>{children}</WalletModalProvider>
+       </SolanaWalletProvider>
+     </ConnectionProvider>
+   );
+ }; 
```

---

Now, let's create a wallet connect button component:


---

```diff
- 
+ import { useWallet } from '@solana/wallet-adapter-react';
+ import { WalletMultiButton } from '@solana/wallet-adapter-react-ui';
+ import { Button } from './ui/button';
+ 
+ export const WalletConnectButton = () => {
+   const { connected } = useWallet();
+ 
+   return (
+     <div className="flex items-center">
+       <WalletMultiButton className="!bg-primary !text-primary-foreground hover:!bg-primary/90">
+         {connected ? 'Connected' : 'Connect Wallet'}
+       </WalletMultiButton>
+     </div>
+   );
+ }; 
```

---

Now, let's modify the root layout to include our WalletProvider:


---

Read file: app/layout.tsx

---

Let's update the layout to use our new Solana WalletProvider:


---

```diff
  import { Toaster } from "@/components/ui/toaster"
  import { AuthProvider } from "@/context/auth-context"
- import { WalletProvider } from "@/context/wallet-context"
+ import { WalletProvider } from "@/context/WalletProvider"
  
  const inter = Inter({ subsets: ["latin"] })
```

```diff
        <body className={inter.className}>
          <ThemeProvider attribute="class" defaultTheme="light" enableSystem disableTransitionOnChange>
-           <AuthProvider>
-             <WalletProvider>
+           <WalletProvider>
+             <AuthProvider>
                <Header />
                <main className="min-h-screen bg-background">{children}</main>
                <Toaster />
-             </WalletProvider>
-           </AuthProvider>
+             </AuthProvider>
+           </WalletProvider>
          </ThemeProvider>
        </body>
```

---

Now, let's update the header component to include our wallet connect button:


---

Read file: components/header.tsx

---

Let's update the header component to use our new wallet connect button:


---

```diff
  import { cn } from "@/lib/utils"
  import { useAuth } from "@/context/auth-context"
- import { useWallet } from "@/context/wallet-context"
  import { UserNav } from "@/components/user-nav"
- import { WalletButton } from "@/components/wallet-button"
  import { Sheet, SheetContent, SheetTrigger } from "@/components/ui/sheet"
  import { Menu } from "lucide-react"
+ import { WalletConnectButton } from "@/components/WalletConnectButton"
  
  export default function Header() {
    const pathname = usePathname()
    const { user } = useAuth()
-   const { isConnected } = useWallet()
  
    const navItems = [
```

```diff
            {user ? (
              <>
-               <WalletButton />
+               <WalletConnectButton />
                <UserNav />
              </>
```

---

Now that we've set up the Solana wallet integration, here's what we've done:

1. Installed the necessary Solana wallet adapter packages
2. Created a `WalletProvider` context that supports Phantom, Backpack, and Solflare wallets
3. Created a `WalletConnectButton` component that uses the wallet adapter UI
4. Updated the root layout to use our new wallet provider
5. Updated the header to use the new wallet connect button

The wallet integration is now ready to use. Users will be able to:
- Connect their Phantom, Backpack, or Solflare wallets
- See their wallet connection status
- Access their wallet's public key and other wallet-related functionality through the `useWallet` hook

You can now use the wallet functionality in any component by importing the `useWallet` hook from `@solana/wallet-adapter-react`. For example:

```typescript
import { useWallet } from '@solana/wallet-adapter-react';

const MyComponent = () => {
  const { publicKey, connected } = useWallet();
  // Use wallet functionality here
};
```

Would you like me to make any adjustments to the implementation or help you with anything else?

---

_**User**_

yes

---

_**Assistant**_

I notice that we should make a few improvements to the current implementation:

1. We should add error handling and loading states to the wallet connection
2. We should add a custom RPC endpoint for better reliability
3. We should add the wallet connection to the mobile menu as well

Let me make these improvements:


---

```diff
  
    // You can also provide a custom RPC endpoint.
-   const endpoint = useMemo(() => clusterApiUrl(network), [network]);
+   const endpoint = useMemo(() => {
+     // Use a custom RPC endpoint for better reliability
+     return process.env.NEXT_PUBLIC_SOLANA_RPC_ENDPOINT || clusterApiUrl(network);
+   }, [network]);
  
    // @solana/wallet-adapter-wallets includes all the adapters but supports tree shaking and lazy loading
```

---

Now let's update the WalletConnectButton component to handle loading and error states:


---

```diff
  import { WalletMultiButton } from '@solana/wallet-adapter-react-ui';
  import { Button } from './ui/button';
+ import { Loader2 } from 'lucide-react';
  
  export const WalletConnectButton = () => {
-   const { connected } = useWallet();
+   const { connected, connecting, disconnecting } = useWallet();
  
    return (
      <div className="flex items-center">
        <WalletMultiButton className="!bg-primary !text-primary-foreground hover:!bg-primary/90">
-         {connected ? 'Connected' : 'Connect Wallet'}
+         {connecting ? (
+           <div className="flex items-center gap-2">
+             <Loader2 className="h-4 w-4 animate-spin" />
+             <span>Connecting...</span>
+           </div>
+         ) : disconnecting ? (
+           <div className="flex items-center gap-2">
+             <Loader2 className="h-4 w-4 animate-spin" />
+             <span>Disconnecting...</span>
+           </div>
+         ) : connected ? (
+           'Connected'
+         ) : (
+           'Connect Wallet'
+         )}
        </WalletMultiButton>
      </div>
```

---

Finally, let's update the header to include the wallet connect button in the mobile menu:


---

```diff
            {user ? (
              <>
+               <div className="hidden md:block">
                  <WalletConnectButton />
+               </div>
                <UserNav />
              </>
```

```diff
                    </Link>
                  ))}
-                 {!user && (
+                 {user ? (
+                   <div className="md:hidden">
+                     <WalletConnectButton />
+                   </div>
+                 ) : (
                    <>
                      <Link href="/auth/login">
```

---

Now the wallet integration is complete with the following improvements:

1. Added a custom RPC endpoint configuration through environment variables (`NEXT_PUBLIC_SOLANA_RPC_ENDPOINT`)
2. Added loading states for connecting and disconnecting
3. Added the wallet connect button to the mobile menu
4. Improved the UI with loading spinners and better state management

To use a custom RPC endpoint, you'll need to add the following to your `.env.local` file:

```
NEXT_PUBLIC_SOLANA_RPC_ENDPOINT=https://your-custom-rpc-endpoint.com
```

You can get a custom RPC endpoint from services like:
- QuickNode
- Alchemy
- Helius
- GenesysGo

Would you like me to make any other improvements or help you with anything else?

---

_**User**_

i am getitng this error

---

_**Assistant**_

I see the issue. There are two main problems:

1. The `BackpackWalletAdapter` is not available in the current version of `@solana/wallet-adapter-wallets`
2. There's a React context issue with the server components

Let's fix these issues:

1. First, let's update the WalletProvider to use only the available wallet adapters:


---

```diff
+ "use client"
+ 
  import { FC, ReactNode, useMemo } from 'react';
  import { ConnectionProvider, WalletProvider as SolanaWalletProvider } from '@solana/wallet-adapter-react';
  import { WalletAdapterNetwork } from '@solana/wallet-adapter-base';
- import { PhantomWalletAdapter, BackpackWalletAdapter, SolflareWalletAdapter } from '@solana/wallet-adapter-wallets';
+ import { PhantomWalletAdapter, SolflareWalletAdapter } from '@solana/wallet-adapter-wallets';
  import { WalletModalProvider } from '@solana/wallet-adapter-react-ui';
  import { clusterApiUrl } from '@solana/web3.js';
```

```diff
      () => [
        new PhantomWalletAdapter(),
-       new BackpackWalletAdapter(),
        new SolflareWalletAdapter(),
      ],
```

---

2. Now let's install the missing `pino-pretty` dependency:


---

```bash
npm install pino-pretty --legacy-peer-deps
```

```
(base) ➜  invofi git:(develop/frontend) ✗ npm install pino-pretty --legacy-peer-deps

added 12 packages, and audited 965 packages in 4s

135 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities
(base) ➜  invofi git:(develop/frontend) ✗
```

---

The changes I made:

1. Added the `"use client"` directive to the WalletProvider component since it uses React hooks and browser APIs
2. Removed the BackpackWalletAdapter since it's not available in the current version
3. Installed the missing `pino-pretty` dependency

These changes should resolve the errors you were seeing. The wallet integration will now support:
- Phantom Wallet
- Solflare Wallet

If you specifically need Backpack wallet support, we would need to install it separately or use a different version of the wallet adapter packages. Would you like me to help you with that, or would you like to test these changes first?

---

_**User**_

why do i still have the sign in and sign up buttons, i want it to be replaced by the wallet connection integration

---

_**Assistant**_

Ah, I see. We need to modify the header to show the wallet connection button instead of the sign in/sign up buttons. Let me update the header component:


---

```diff
  import { usePathname } from "next/navigation"
  import { cn } from "@/lib/utils"
- import { useAuth } from "@/context/auth-context"
  import { UserNav } from "@/components/user-nav"
  import { Sheet, SheetContent, SheetTrigger } from "@/components/ui/sheet"
```

```diff
  export default function Header() {
    const pathname = usePathname()
-   const { user } = useAuth()
  
    const navItems = [
      { name: "Home", href: "/" },
      { name: "Create Invoice", href: "/invoice/create" },
      { name: "Tokenize Invoice", href: "/invoice/tokenize" },
-     ...(user ? [{ name: "Dashboard", href: "/dashboard" }] : []),
    ]
  
```

```diff
  
          <div className="flex items-center space-x-2">
-           {user ? (
-             <>
            <div className="hidden md:block">
              <WalletConnectButton />
            </div>
-               <UserNav />
-             </>
-           ) : (
-             <>
-               <Link href="/auth/login" className="hidden sm:block">
-                 <Button variant="outline" size="sm">
-                   Sign In
-                 </Button>
-               </Link>
-               <Link href="/auth/register" className="hidden sm:block">
-                 <Button size="sm">Sign Up</Button>
-               </Link>
-             </>
-           )}
            <ModeToggle />
  
```

```diff
                    </Link>
                  ))}
-                 {user ? (
                  <div className="md:hidden">
                    <WalletConnectButton />
                  </div>
-                 ) : (
-                   <>
-                     <Link href="/auth/login">
-                       <Button variant="outline" className="w-full">
-                         Sign In
-                       </Button>
-                     </Link>
-                     <Link href="/auth/register">
-                       <Button className="w-full">Sign Up</Button>
-                     </Link>
-                   </>
-                 )}
                </div>
              </SheetContent>
```

---

I've made the following changes to the header:

1. Removed all sign in/sign up buttons
2. Removed the auth context dependency since we're not using it anymore
3. Removed the conditional rendering based on user state
4. Always show the wallet connect button in both desktop and mobile views
5. Removed the dashboard link from nav items since it was tied to the auth state
6. Removed the UserNav component since it was part of the auth system

Now the header will:
- Always show the wallet connect button
- Show the wallet connect button in both desktop and mobile views
- Have a cleaner navigation focused on the core features (Home, Create Invoice, Tokenize Invoice)

The wallet connection will be the primary way for users to interact with the application. Would you like me to make any other adjustments to the header or other components?

---

_**User**_

ok cool, the button tho looks to big and the color is purple and should be same blue as everywhere else on the website, lets do the connect more minimalistic and similar to e.g @https://jup.ag/ i want it to look sleek

---

_**Assistant**_

I'll update the WalletConnectButton component to make it more minimalistic and match the website's color scheme. Let me modify the component:


---

```diff
    return (
      <div className="flex items-center">
-       <WalletMultiButton className="!bg-primary !text-primary-foreground hover:!bg-primary/90">
+       <WalletMultiButton className="!bg-transparent !text-foreground hover:!bg-accent !border !border-input !rounded-md !h-9 !px-3 !text-sm !font-medium">
          {connecting ? (
            <div className="flex items-center gap-2">
```

```diff
            'Connected'
          ) : (
-           'Connect Wallet'
+           'Connect'
          )}
        </WalletMultiButton>
```

---

I've made the following changes to make the button more minimalistic and match the website's style:

1. Changed the background to transparent with a subtle border
2. Made the text color match the website's foreground color
3. Added a subtle hover effect with the accent color
4. Reduced the height and padding to make it more compact
5. Made the font size smaller and medium weight
6. Changed the text from "Connect Wallet" to just "Connect" to be more concise
7. Added rounded corners to match the website's button style

The button now has a more subtle, minimalistic look similar to Jupiter's design, while maintaining the functionality. The styling uses the website's existing color scheme and design system.

Would you like me to make any other adjustments to the button's appearance?

---

_**User**_

Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:

- A server/client branch `if (typeof window !== 'undefined')`.
- Variable input such as `Date.now()` or `Math.random()` which changes each time it's called.
- Date formatting in a user's locale which doesn't match the server.
- External changing data without sending a snapshot of it along with the HTML.
- Invalid HTML tag nesting.

It can also happen if the client has a browser extension installed which messes with the HTML before React loaded.

See more info here: https://nextjs.org/docs/messages/react-hydration-error


  ...
    <AuthProvider>
      <Header>
        <header className="border-b b...">
          <div className="container ...">
            <div>
            <div className="flex items...">
              <div className="hidden md:...">
                <WalletConnectButton>
                  <div className="flex items...">
                    <WalletMultiButton className="!bg-transp...">
                      <BaseWalletMultiButton className="!bg-transp..." labels={{...}}>
                        <div className="wallet-ada...">
                          <BaseWalletConnectionButton className="!bg-transp..." aria-expanded={false} style={{...}} ...>
                            <Button className="wallet-ada..." aria-expanded={false} style={{...}} ...>
                              <button className="wallet-ada..." disabled={undefined} style={{...}} ...>
+                               <i className="wallet-adapter-button-start-icon">
-                               Connect
                                ...
                          ...
              ...
      ...
components/WalletConnectButton.tsx (11:7) @ WalletConnectButton


   9 |   return (
  10 |     <div className="flex items-center">
> 11 |       <WalletMultiButton className="!bg-transparent !text-foreground hover:!bg-accent !border !border-input !rounded-md !h-9 !px-3 !text-sm !font-medium">
     |       ^
  12 |         {connecting ? (
  13 |           <div className="flex items-center gap-2">
  14 |             <Loader2 className="h-4 w-4 animate-spin" />

getting this issue

---

_**Assistant**_

This hydration error is happening because the wallet adapter's button is trying to render different content on the server and client. Let's fix this by making the WalletConnectButton a client-only component and adding proper loading states:


---

```diff
+ "use client"
+ 
  import { useWallet } from '@solana/wallet-adapter-react';
  import { WalletMultiButton } from '@solana/wallet-adapter-react-ui';
  import { Button } from './ui/button';
  import { Loader2 } from 'lucide-react';
+ import { useEffect, useState } from 'react';
  
  export const WalletConnectButton = () => {
    const { connected, connecting, disconnecting } = useWallet();
+   const [mounted, setMounted] = useState(false);
+ 
+   useEffect(() => {
+     setMounted(true);
+   }, []);
+ 
+   if (!mounted) {
+     return (
+       <Button
+         variant="outline"
+         className="h-9 px-3 text-sm font-medium"
+         disabled
+       >
+         Loading...
+       </Button>
+     );
+   }
  
    return (
```

---

I've made the following changes to fix the hydration issue:

1. Added the `"use client"` directive at the top of the file to ensure it's treated as a client component
2. Added a `mounted` state to track when the component is mounted on the client
3. Added a loading state that shows a simple button while the component is not mounted
4. Only render the WalletMultiButton after the component is mounted on the client

This should resolve the hydration mismatch because:
- The server will always render the loading state
- The client will initially render the loading state
- Once mounted, the client will render the actual wallet button
- The transition will be smooth and won't cause any layout shifts

The button will now:
1. Show a simple "Loading..." button during server-side rendering and initial client-side rendering
2. Smoothly transition to the wallet connect button once mounted
3. Maintain all the styling and functionality we set up earlier

Would you like me to make any other adjustments to the component?

---

_**User**_

the button is always showing loading and i see this errors in browser console

Uncaught TypeError: Cannot redefine property: ethereum
    at Object.defineProperty (<anonymous>)
    at r.inject (evmAsk.js:9:7920)
    at Wk.window.addEventListener.once (evmAsk.js:9:11903)
injected.js:1 Backpack couldn't override `window.ethereum`.
Lxs @ injected.js:1
content.js:1 Deprecated API for given entry type.
value @ content.js:1
react-dom-client.development.js:24915 Download the React DevTools for a better development experience: https://react.dev/link/react-devtools
react-server-dom-webpack-client.browser.development.js:2648  Server   ⚠ metadataBase property in metadata export is not set for resolving social open graph or twitter images, using "http://localhost:3000". See https://nextjs.org/docs/app/api-reference/functions/generate-metadata#metadatabase
react-stack-bottom-frame @ react-server-dom-webpack-client.browser.development.js:2648
vendor.js:142 Uncaught (in promise) Error: A listener indicated an asynchronous response by returning true, but the message channel closed before a response was received
    at g (vendor.js:142:18472)

---

_**Assistant**_

The issue seems to be related to the wallet adapter initialization. Let's modify the WalletProvider and WalletConnectButton to handle the initialization more gracefully:


---

```diff
    return (
      <ConnectionProvider endpoint={endpoint}>
-       <SolanaWalletProvider wallets={wallets} autoConnect>
+       <SolanaWalletProvider wallets={wallets} autoConnect={false}>
          <WalletModalProvider>{children}</WalletModalProvider>
        </SolanaWalletProvider>
```

---

Now let's update the WalletConnectButton to handle the initialization better:


---

```diff
  
  export const WalletConnectButton = () => {
-   const { connected, connecting, disconnecting } = useWallet();
+   const { connected, connecting, disconnecting, select } = useWallet();
    const [mounted, setMounted] = useState(false);
+   const [error, setError] = useState<string | null>(null);
  
    useEffect(() => {
      setMounted(true);
    }, []);
+ 
+   const handleConnect = async () => {
+     try {
+       setError(null);
+       await select();
+     } catch (err) {
+       setError('Failed to connect wallet');
+       console.error('Wallet connection error:', err);
+     }
+   };
  
    if (!mounted) {
```

```diff
      );
    }
+ 
+   if (error) {
+     return (
+       <Button
+         variant="outline"
+         className="h-9 px-3 text-sm font-medium text-destructive"
+         onClick={handleConnect}
+       >
+         Retry Connect
+       </Button>
+     );
+   }
  
    return (
      <div className="flex items-center">
-       <WalletMultiButton className="!bg-transparent !text-foreground hover:!bg-accent !border !border-input !rounded-md !h-9 !px-3 !text-sm !font-medium">
+       <WalletMultiButton 
+         className="!bg-transparent !text-foreground hover:!bg-accent !border !border-input !rounded-md !h-9 !px-3 !text-sm !font-medium"
+         onClick={handleConnect}
+       >
          {connecting ? (
            <div className="flex items-center gap-2">
```

---

I've made several changes to fix the issues:

1. In the WalletProvider:
   - Disabled `autoConnect` to prevent automatic connection attempts that might cause issues
   - This will give us more control over the connection process

2. In the WalletConnectButton:
   - Added error handling with a retry mechanism
   - Added a custom `handleConnect` function that uses the `select` method
   - Added error state to show a retry button if connection fails
   - Added proper error logging
   - Made the connection process more controlled

These changes should:
1. Fix the loading state issue
2. Handle wallet connection errors gracefully
3. Provide a better user experience with retry functionality
4. Reduce console errors related to wallet initialization

The button will now:
1. Show "Loading..." only during initial mount
2. Show "Connect" when ready
3. Show "Connecting..." during connection
4. Show "Retry Connect" if there's an error
5. Show "Connected" when successfully connected

Would you like me to make any other adjustments to handle specific wallet-related issues?

---

